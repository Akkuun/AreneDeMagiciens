[gd_resource type="BehaviorTree" load_steps=46 format=3 uid="uid://cqdkws254vlu4"]

[ext_resource type="Script" uid="uid://dt7wqjp2mu2xk" path="res://ai/tasks/is_player_detected.gd" id="1_rsv4q"]
[ext_resource type="PackedScene" path="res://Scenes/objects/projectile.tscn" id="2_jswlx"]
[ext_resource type="Script" uid="uid://bjnw6bprdrgl7" path="res://ai/tasks/face_target.gd" id="2_mi6ct"]
[ext_resource type="Script" uid="uid://uja7ux25b6vd" path="res://ai/tasks/shoot_projectile.gd" id="3_mi6ct"]
[ext_resource type="Script" uid="uid://dmx4g6vr6u2c6" path="res://ai/tasks/select_flanking_pos.gd" id="3_rsv4q"]
[ext_resource type="Script" uid="uid://nrg0phxx4b66" path="res://ai/tasks/arrive_pos.gd" id="4_aeqyo"]
[ext_resource type="Script" uid="uid://cpbl4mrwds458" path="res://ai/tasks/update_loose_point.gd" id="5_mh77e"]
[ext_resource type="Script" uid="uid://dpuxx3ag1bpqv" path="res://ai/tasks/select_random_patrol_pos.gd" id="6_jswlx"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_ocnie"]

[sub_resource type="BBNode" id="BBNode_aeqyo"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_mh77e"]
animation_player = SubResource("BBNode_aeqyo")
animation_name = &"Idle"
blend = 0.2
_enabled = false

[sub_resource type="BTCondition" id="BTCondition_aeqyo"]
script = ExtResource("1_rsv4q")
player_group = &"dummy"

[sub_resource type="BTRandomWait" id="BTRandomWait_rsv4q"]
min_duration = 1.2
max_duration = 3.0
_enabled = false

[sub_resource type="BTAction" id="BTAction_6n8ae"]
script = ExtResource("2_mi6ct")

[sub_resource type="BBNode" id="BBNode_jswlx"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_mi6ct"]
animation_player = SubResource("BBNode_jswlx")
animation_name = &"Spell2"

[sub_resource type="BTWait" id="BTWait_jswlx"]
duration = 1.1

[sub_resource type="BTAction" id="BTAction_t88kj"]
script = ExtResource("3_mi6ct")
projectile_scene = ExtResource("2_jswlx")
spawn_offset = Vector3(0, 1.5, 0)
max_range = 20.0

[sub_resource type="BTWait" id="BTWait_6n8ae"]
duration = 2.0

[sub_resource type="BTSequence" id="BTSequence_05aup"]
custom_name = "Attack"
children = [SubResource("BTAction_6n8ae"), SubResource("BTPlayAnimation_mi6ct"), SubResource("BTWait_jswlx"), SubResource("BTAction_t88kj"), SubResource("BTWait_6n8ae")]

[sub_resource type="BTAction" id="BTAction_r7adr"]
script = ExtResource("3_rsv4q")
target_var = &"detected_player"
range_min = 5.0
range_max = 8.0

[sub_resource type="BBNode" id="BBNode_r7adr"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_rsv4q"]
animation_player = SubResource("BBNode_r7adr")
animation_name = &"Run"
blend = 0.1

[sub_resource type="BTAction" id="BTAction_rsv4q"]
script = ExtResource("4_aeqyo")
avoid_var = &"detected_player"

[sub_resource type="BTTimeLimit" id="BTTimeLimit_07ai8"]
time_limit = 7.0
children = [SubResource("BTAction_rsv4q")]

[sub_resource type="BBNode" id="BBNode_rsv4q"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTStopAnimation" id="BTStopAnimation_aeqyo"]
animation_player = SubResource("BBNode_rsv4q")
animation_name = &"Run"

[sub_resource type="BTWait" id="BTWait_aeqyo"]
duration = 3.0

[sub_resource type="BTSequence" id="BTSequence_t88kj"]
custom_name = "Change flank"
children = [SubResource("BTAction_r7adr"), SubResource("BTPlayAnimation_rsv4q"), SubResource("BTTimeLimit_07ai8"), SubResource("BTStopAnimation_aeqyo"), SubResource("BTWait_aeqyo")]
metadata/_weight_ = 0.5001500150015001

[sub_resource type="BTSelector" id="BTSelector_1uvjn"]
custom_name = "Choice"
children = [SubResource("BTSequence_05aup"), SubResource("BTSequence_t88kj")]

[sub_resource type="BTSequence" id="BTSequence_jswlx"]
custom_name = "Fight"
children = [SubResource("BTCondition_aeqyo"), SubResource("BTRandomWait_rsv4q"), SubResource("BTSelector_1uvjn")]

[sub_resource type="BTAction" id="BTAction_mi6ct"]
script = ExtResource("5_mh77e")

[sub_resource type="BTAction" id="BTAction_07ai8"]
script = ExtResource("6_jswlx")
patrol_radius = 7.0

[sub_resource type="BBNode" id="BBNode_t88kj"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_6n8ae"]
animation_player = SubResource("BBNode_t88kj")
animation_name = &"Walk"
blend = 0.2

[sub_resource type="BTAction" id="BTAction_05aup"]
script = ExtResource("4_aeqyo")
target_position_var = &"patrol_pos"
speed_mode = "walk"

[sub_resource type="BTTimeLimit" id="BTTimeLimit_aeqyo"]
children = [SubResource("BTAction_05aup")]

[sub_resource type="BBNode" id="BBNode_1uvjn"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTStopAnimation" id="BTStopAnimation_ubene"]
animation_player = SubResource("BBNode_1uvjn")
animation_name = &"Walk"
_enabled = false

[sub_resource type="BBNode" id="BBNode_73vhv"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_g37qj"]
animation_player = SubResource("BBNode_73vhv")
animation_name = &"Idle"
blend = 0.1

[sub_resource type="BTRandomWait" id="BTRandomWait_deuai"]
min_duration = 1.5
max_duration = 2.5

[sub_resource type="BTSequence" id="BTSequence_mh77e"]
custom_name = "Patrol"
children = [SubResource("BTAction_mi6ct"), SubResource("BTAction_07ai8"), SubResource("BTPlayAnimation_6n8ae"), SubResource("BTTimeLimit_aeqyo"), SubResource("BTStopAnimation_ubene"), SubResource("BTPlayAnimation_g37qj"), SubResource("BTRandomWait_deuai")]

[sub_resource type="BTSelector" id="BTSelector_jswlx"]
children = [SubResource("BTSequence_jswlx"), SubResource("BTSequence_mh77e")]

[sub_resource type="BTSequence" id="BTSequence_mi6ct"]
custom_name = "MAin"
children = [SubResource("BTPlayAnimation_mh77e"), SubResource("BTSelector_jswlx")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_ocnie")
root_task = SubResource("BTSequence_mi6ct")
